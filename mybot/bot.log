2025-07-18 20:38:12,789 - __main__ - INFO - main:127 - Inicializando base de datos...
2025-07-18 20:38:12,789 - database.setup - INFO - init_db:59 - Creando motor de base de datos...
2025-07-18 20:38:15,661 - database.setup - CRITICAL - init_db:73 - Error crítico en init_db: [Errno 7] No address associated with hostname
2025-07-18 20:38:15,662 - __main__ - CRITICAL - main:221 - Error crítico en main(): [Errno 7] No address associated with hostname
Traceback (most recent call last):
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/bot.py", line 128, in main
    await init_db()
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/database/setup.py", line 66, in init_db
    async with _engine.begin() as conn:
               ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
               ^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3273, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3297, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 713, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 308, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 675, in __init__
    self.__connect()
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 901, in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 961, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1083, in create_connection
    infos = await self._ensure_resolved(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1466, in _ensure_resolved
    return await loop.getaddrinfo(host, port, family=family, type=type,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 905, in getaddrinfo
    return await self.run_in_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/socket.py", line 978, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 7] No address associated with hostname
2025-07-18 20:38:15,715 - __main__ - INFO - main:224 - Cerrando bot...
2025-07-18 20:38:15,716 - __main__ - ERROR - main:230 - Error durante el cierre: cannot access local variable 'task_manager' where it is not associated with a value
Traceback (most recent call last):
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/bot.py", line 128, in main
    await init_db()
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/database/setup.py", line 66, in init_db
    async with _engine.begin() as conn:
               ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
               ^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3273, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3297, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 713, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 308, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 675, in __init__
    self.__connect()
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 901, in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 961, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1083, in create_connection
    infos = await self._ensure_resolved(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1466, in _ensure_resolved
    return await loop.getaddrinfo(host, port, family=family, type=type,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 905, in getaddrinfo
    return await self.run_in_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/socket.py", line 978, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 7] No address associated with hostname

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/bot.py", line 226, in main
    await task_manager.shutdown()
          ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'task_manager' where it is not associated with a value
2025-07-18 20:38:15,735 - root - CRITICAL - <module>:239 - Error fatal: [Errno 7] No address associated with hostname
Traceback (most recent call last):
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/bot.py", line 235, in <module>
    asyncio.run(main())
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 691, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/bot.py", line 128, in main
    await init_db()
  File "/data/data/com.termux/files/home/repos/Botmaestro2/mybot/database/setup.py", line 66, in init_db
    async with _engine.begin() as conn:
               ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
               ^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3273, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 145, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3297, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 449, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 713, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 308, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 390, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 675, in __init__
    self.__connect()
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 901, in __connect
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 897, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 625, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 961, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1083, in create_connection
    infos = await self._ensure_resolved(
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 1466, in _ensure_resolved
    return await loop.getaddrinfo(host, port, family=family, type=type,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/asyncio/base_events.py", line 905, in getaddrinfo
    return await self.run_in_executor(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/socket.py", line 978, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
socket.gaierror: [Errno 7] No address associated with hostname
2025-08-16 04:25:13,575 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:25:13,577 - database.setup - INFO - init_db:59 - Inicializando motor de base de datos PostgreSQL...
2025-08-16 04:25:13,731 - database.setup - CRITICAL - init_db:81 - Error crítico al inicializar la base de datos: [Errno 111] Connect call failed ('127.0.0.1', 5432)
2025-08-16 04:25:13,731 - __main__ - CRITICAL - main:244 - Error crítico en main(): [Errno 111] Connect call failed ('127.0.0.1', 5432)
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1122, in create_connection
    raise exceptions[0]
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1104, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1007, in _connect_sock
    await self.sock_connect(sock, address)
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 651, in sock_connect
    return await fut
           ^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 691, in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
2025-08-16 04:25:13,776 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 04:25:13,777 - __main__ - ERROR - main:253 - Error durante el cierre: cannot access local variable 'task_manager' where it is not associated with a value
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1122, in create_connection
    raise exceptions[0]
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1104, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1007, in _connect_sock
    await self.sock_connect(sock, address)
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 651, in sock_connect
    return await fut
           ^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 691, in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 249, in main
    await task_manager.shutdown()
          ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'task_manager' where it is not associated with a value
2025-08-16 04:25:13,784 - root - CRITICAL - <module>:262 - Error fatal: [Errno 111] Connect call failed ('127.0.0.1', 5432)
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 258, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1075, in _connect
    raise last_error or exceptions.TargetServerAttributeNotMatched(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 886, in _connect_addr
    return await __connect_addr(params, True, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 931, in __connect_addr
    tr, pr = await connector
             ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 802, in _create_ssl_connection
    tr, pr = await loop.create_connection(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1122, in create_connection
    raise exceptions[0]
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1104, in create_connection
    sock = await self._connect_sock(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1007, in _connect_sock
    await self.sock_connect(sock, address)
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 651, in sock_connect
    return await fut
           ^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/selector_events.py", line 691, in _sock_connect_cb
    raise OSError(err, f'Connect call failed {address}')
ConnectionRefusedError: [Errno 111] Connect call failed ('127.0.0.1', 5432)
2025-08-16 04:25:38,021 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:25:38,022 - database.setup - INFO - init_db:59 - Inicializando motor de base de datos PostgreSQL...
2025-08-16 04:25:38,022 - database.setup - CRITICAL - init_db:81 - Error crítico al inicializar la base de datos: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:25:38,022 - __main__ - CRITICAL - main:244 - Error crítico en main(): DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:25:38,030 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 04:25:38,031 - __main__ - ERROR - main:253 - Error durante el cierre: cannot access local variable 'task_manager' where it is not associated with a value
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 249, in main
    await task_manager.shutdown()
          ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'task_manager' where it is not associated with a value
2025-08-16 04:25:38,032 - root - CRITICAL - <module>:262 - Error fatal: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 258, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:30:23,659 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:30:23,659 - database.setup - INFO - init_db:59 - Inicializando motor de base de datos PostgreSQL...
2025-08-16 04:30:24,037 - database.setup - CRITICAL - init_db:81 - Error crítico al inicializar la base de datos: password authentication failed for user "postgres"
2025-08-16 04:30:24,038 - __main__ - CRITICAL - main:244 - Error crítico en main(): password authentication failed for user "postgres"
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 891, in _connect_addr
    return await __connect_addr(params_retry, False, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 934, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "postgres"
2025-08-16 04:30:24,067 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 04:30:24,067 - __main__ - ERROR - main:253 - Error durante el cierre: cannot access local variable 'task_manager' where it is not associated with a value
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 891, in _connect_addr
    return await __connect_addr(params_retry, False, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 934, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "postgres"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 249, in main
    await task_manager.shutdown()
          ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'task_manager' where it is not associated with a value
2025-08-16 04:30:24,077 - root - CRITICAL - <module>:262 - Error fatal: password authentication failed for user "postgres"
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 258, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 73, in init_db
    async with _engine.begin() as conn:
  File "/usr/lib/python3.12/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 1066, in begin
    async with conn:
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/base.py", line 121, in __aenter__
    return await self.start(is_ctxmanager=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/engine.py", line 274, in start
    await greenlet_spawn(self.sync_engine.connect)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 711, in checkout
    rec = pool._do_get()
          ^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/impl.py", line 306, in _do_get
    return self._create_connection()
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 673, in __init__
    self.__connect()
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 899, in __connect
    with util.safe_reraise():
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/pool/base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/create.py", line 661, in connect
    return dialect.connect(*cargs, **cparams)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 629, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 964, in connect
    await_only(creator_fn(*arg, **kw)),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connection.py", line 2421, in connect
    return await connect_utils._connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 1049, in _connect
    conn = await _connect_addr(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 891, in _connect_addr
    return await __connect_addr(params_retry, False, *args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/asyncpg/connect_utils.py", line 934, in __connect_addr
    await connected
asyncpg.exceptions.InvalidPasswordError: password authentication failed for user "postgres"
2025-08-16 04:31:05,447 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:31:05,449 - database.setup - INFO - init_db:59 - Inicializando motor de base de datos PostgreSQL...
2025-08-16 04:31:05,449 - database.setup - CRITICAL - init_db:81 - Error crítico al inicializar la base de datos: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:31:05,449 - __main__ - CRITICAL - main:244 - Error crítico en main(): DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:31:05,452 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 04:31:05,452 - __main__ - ERROR - main:253 - Error durante el cierre: cannot access local variable 'task_manager' where it is not associated with a value
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 249, in main
    await task_manager.shutdown()
          ^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'task_manager' where it is not associated with a value
2025-08-16 04:31:05,454 - root - CRITICAL - <module>:262 - Error fatal: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 258, in <module>
    asyncio.run(main())
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 145, in main
    await init_db()
  File "/home/carlostoek/repos/bolt_ok/mybot/database/setup.py", line 64, in init_db
    raise ValueError("DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.")
ValueError: DATABASE_URL debe comenzar con 'postgresql+asyncpg://' para usar PostgreSQL async.
2025-08-16 04:33:59,885 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:33:59,887 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 04:33:59,953 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 04:34:01,089 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 04:34:01,091 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 04:34:01,091 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 04:34:01,092 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 04:34:01,167 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 04:34:01,167 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 04:34:01,167 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 04:34:01,167 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 04:34:01,167 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 04:34:01,169 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 04:34:01,170 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 04:34:01,170 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 04:34:01,170 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 04:34:01,171 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 04:34:01,171 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 04:34:01,171 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 04:34:01,171 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 04:34:01,172 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 04:34:01,173 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 04:34:01,175 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 04:34:01,178 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 04:34:01,179 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 04:34:01,181 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 04:34:01,320 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 04:34:47,243 - services.user_service - INFO - create_user:55 - Created new user: 1280444712
2025-08-16 04:34:47,244 - middlewares.user_middleware - INFO - __call__:49 - Created new user via middleware: 1280444712
2025-08-16 04:34:58,950 - handlers.start - INFO - cmd_start:29 - Start command received from user 1280444712
2025-08-16 04:34:58,953 - handlers.start - INFO - cmd_start:115 - Regular user 1280444712 accessing start command
2025-08-16 04:38:01,529 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 04:38:01,532 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 04:38:01,645 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 04:38:01,689 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 04:38:01,693 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 04:38:01,693 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 04:38:01,693 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 04:38:01,800 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 04:38:01,801 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 04:38:01,801 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 04:38:01,801 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 04:38:01,802 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 04:38:01,803 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 04:38:01,803 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 04:38:01,803 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 04:38:01,804 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 04:38:01,804 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 04:38:01,804 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 04:38:01,804 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 04:38:01,804 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 04:38:01,805 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 04:38:01,806 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 04:38:01,810 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 04:38:01,830 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 04:38:01,832 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 04:38:01,837 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 04:38:01,970 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 20:45:01,508 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 20:45:01,508 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 20:45:01,525 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 20:45:01,542 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 20:45:01,543 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 20:45:01,543 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 20:45:01,543 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 20:45:01,589 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 20:45:01,589 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 20:45:01,590 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 20:45:01,590 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 20:45:01,591 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 20:45:01,593 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 20:45:01,594 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 20:45:01,595 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 20:45:01,596 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 20:45:01,666 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 20:45:01,669 - root - ERROR - vip_subscription_scheduler:140 - Unhandled error in VIP subscription scheduler
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 177, in execute
    self._adapt_connection._handle_exception(error)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 337, in _handle_exception
    raise error
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 159, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.OperationalError: no such column: users.vip_until

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/services/scheduler.py", line 129, in vip_subscription_scheduler
    await run_vip_subscription_check(bot, session_factory)
  File "/home/carlostoek/repos/bolt_ok/mybot/services/scheduler.py", line 65, in run_vip_subscription_check
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 177, in execute
    self._adapt_connection._handle_exception(error)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 337, in _handle_exception
    raise error
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/dialects/sqlite/aiosqlite.py", line 159, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiosqlite/core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id, users.username, users.first_name, users.last_name, users.points, users.level, users.achievements, users.missions_completed, users.last_daily_mission_reset, users.last_weekly_mission_reset, users.created_at, users.updated_at, users.role, users.vip_expires_at, users.vip_until, users.last_reminder_sent_at, users.menu_state, users.is_admin 
FROM users 
WHERE users.role = ? AND users.vip_expires_at <= ? AND users.vip_expires_at > ? AND (users.last_reminder_sent_at IS NULL OR users.last_reminder_sent_at <= ?)]
[parameters: ('vip', '2025-08-17 20:45:01.593739', '2025-08-16 20:45:01.593739', '2025-08-15 20:45:01.593739')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,319 - services.user_service - ERROR - get_user:19 - Error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id AS users_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.points AS users_points, users.level AS users_level, users.achievements AS users_achievements, users.missions_completed AS users_missions_completed, users.last_daily_mission_reset AS users_last_daily_mission_reset, users.last_weekly_mission_reset AS users_last_weekly_mission_reset, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.role AS users_role, users.vip_expires_at AS users_vip_expires_at, users.vip_until AS users_vip_until, users.last_reminder_sent_at AS users_last_reminder_sent_at, users.menu_state AS users_menu_state, users.is_admin AS users_is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,320 - services.user_service - ERROR - get_user:27 - Secondary error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id, users.username, users.first_name, users.last_name, users.points, users.level, users.achievements, users.missions_completed, users.last_daily_mission_reset, users.last_weekly_mission_reset, users.created_at, users.updated_at, users.role, users.vip_expires_at, users.vip_until, users.last_reminder_sent_at, users.menu_state, users.is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,321 - services.user_service - ERROR - get_user:19 - Error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id AS users_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.points AS users_points, users.level AS users_level, users.achievements AS users_achievements, users.missions_completed AS users_missions_completed, users.last_daily_mission_reset AS users_last_daily_mission_reset, users.last_weekly_mission_reset AS users_last_weekly_mission_reset, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.role AS users_role, users.vip_expires_at AS users_vip_expires_at, users.vip_until AS users_vip_until, users.last_reminder_sent_at AS users_last_reminder_sent_at, users.menu_state AS users_menu_state, users.is_admin AS users_is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,322 - services.user_service - ERROR - get_user:27 - Secondary error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id, users.username, users.first_name, users.last_name, users.points, users.level, users.achievements, users.missions_completed, users.last_daily_mission_reset, users.last_weekly_mission_reset, users.created_at, users.updated_at, users.role, users.vip_expires_at, users.vip_until, users.last_reminder_sent_at, users.menu_state, users.is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,326 - services.user_service - ERROR - create_user:59 - Error creating user 1280444712: (sqlite3.OperationalError) table users has no column named vip_until
[SQL: INSERT INTO users (id, username, first_name, last_name, points, level, achievements, missions_completed, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at, role, vip_expires_at, vip_until, last_reminder_sent_at, menu_state, is_admin) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?, ?, ?, ?, ?) RETURNING id, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at]
[parameters: (1280444712, 'Corther1', 'Corther', None, 0.0, 1, '{}', '{}', 'free', None, None, None, 'root', 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,328 - services.user_service - ERROR - get_user:19 - Error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id AS users_id, users.username AS users_username, users.first_name AS users_first_name, users.last_name AS users_last_name, users.points AS users_points, users.level AS users_level, users.achievements AS users_achievements, users.missions_completed AS users_missions_completed, users.last_daily_mission_reset AS users_last_daily_mission_reset, users.last_weekly_mission_reset AS users_last_weekly_mission_reset, users.created_at AS users_created_at, users.updated_at AS users_updated_at, users.role AS users_role, users.vip_expires_at AS users_vip_expires_at, users.vip_until AS users_vip_until, users.last_reminder_sent_at AS users_last_reminder_sent_at, users.menu_state AS users_menu_state, users.is_admin AS users_is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,329 - services.user_service - ERROR - get_user:27 - Secondary error getting user 1280444712: (sqlite3.OperationalError) no such column: users.vip_until
[SQL: SELECT users.id, users.username, users.first_name, users.last_name, users.points, users.level, users.achievements, users.missions_completed, users.last_daily_mission_reset, users.last_weekly_mission_reset, users.created_at, users.updated_at, users.role, users.vip_expires_at, users.vip_until, users.last_reminder_sent_at, users.menu_state, users.is_admin 
FROM users 
WHERE users.id = ?]
[parameters: (1280444712,)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:02,329 - middlewares.user_middleware - ERROR - __call__:55 - Error processing user in middleware: (sqlite3.OperationalError) table users has no column named vip_until
[SQL: INSERT INTO users (id, username, first_name, last_name, points, level, achievements, missions_completed, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at, role, vip_expires_at, vip_until, last_reminder_sent_at, menu_state, is_admin) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?, ?, ?, ?, ?) RETURNING id, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at]
[parameters: (1280444712, 'Corther1', 'Corther', None, 0.0, 1, '{}', '{}', 'free', None, None, None, 'root', 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-08-16 20:45:08,159 - aiogram.dispatcher - WARNING - _signal_stop_polling:491 - Received SIGTERM signal
2025-08-16 20:45:08,411 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 20:45:08,412 - root - INFO - shutdown:125 - Cerrando tareas en segundo plano...
2025-08-16 20:45:08,412 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-16 20:45:08,412 - root - INFO - safe_task:114 - Tarea channel_requests cancelada
2025-08-16 20:45:08,412 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-16 20:45:08,412 - root - INFO - safe_task:114 - Tarea vip_memberships cancelada
2025-08-16 20:45:08,412 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-16 20:45:08,412 - root - INFO - safe_task:114 - Tarea auction_monitor cancelada
2025-08-16 20:45:08,412 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-16 20:45:08,412 - root - INFO - safe_task:114 - Tarea channel_cleanup cancelada
2025-08-16 20:45:08,412 - root - INFO - shutdown:134 - Todas las tareas cerradas
2025-08-16 20:46:46,890 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 20:46:46,890 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 20:46:46,906 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 20:46:46,921 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 20:46:46,922 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 20:46:46,922 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 20:46:46,922 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 20:46:46,963 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 20:46:46,963 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 20:46:46,964 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 20:46:46,964 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 20:46:46,965 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 20:46:46,967 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 20:46:46,968 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 20:46:46,969 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 20:46:46,970 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 20:46:47,031 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 20:46:47,678 - services.user_service - ERROR - create_user:59 - Error creating user 1280444712: (sqlite3.IntegrityError) UNIQUE constraint failed: users.id
[SQL: INSERT INTO users (id, username, first_name, last_name, points, level, achievements, missions_completed, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at, role, vip_expires_at, vip_until, last_reminder_sent_at, menu_state, is_admin) VALUES (?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?, ?, ?, ?, ?) RETURNING id, last_daily_mission_reset, last_weekly_mission_reset, created_at, updated_at]
[parameters: (1280444712, 'Corther1', 'Corther', None, 0.0, 1, '{}', '{}', 'free', None, None, None, 'root', 0)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-08-16 20:46:47,686 - services.user_service - INFO - create_user:55 - Created new user: 1280444712
2025-08-16 20:46:47,686 - middlewares.user_middleware - INFO - __call__:49 - Created new user via middleware: 1280444712
2025-08-16 20:46:47,694 - services.user_service - INFO - create_user:65 - Found existing user after error: 1280444712
2025-08-16 20:46:47,694 - middlewares.user_middleware - INFO - __call__:49 - Created new user via middleware: 1280444712
2025-08-16 20:46:51,735 - aiogram.dispatcher - WARNING - _signal_stop_polling:491 - Received SIGTERM signal
2025-08-16 20:46:51,988 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 20:46:51,988 - root - INFO - shutdown:125 - Cerrando tareas en segundo plano...
2025-08-16 20:46:51,988 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-16 20:46:51,988 - root - INFO - safe_task:114 - Tarea channel_requests cancelada
2025-08-16 20:46:51,988 - root - INFO - vip_subscription_scheduler:137 - VIP subscription scheduler cancelled
2025-08-16 20:46:51,989 - root - INFO - safe_task:114 - Tarea vip_subscriptions cancelada
2025-08-16 20:46:51,989 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-16 20:46:51,989 - root - INFO - safe_task:114 - Tarea vip_memberships cancelada
2025-08-16 20:46:51,989 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-16 20:46:51,989 - root - INFO - safe_task:114 - Tarea auction_monitor cancelada
2025-08-16 20:46:51,989 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-16 20:46:51,989 - root - INFO - safe_task:114 - Tarea channel_cleanup cancelada
2025-08-16 20:46:51,989 - root - INFO - shutdown:134 - Todas las tareas cerradas
2025-08-16 21:01:34,170 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 21:01:34,170 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 21:01:34,186 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 21:01:34,201 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 21:01:34,202 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 21:01:34,202 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 21:01:34,202 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 21:01:34,243 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 21:01:34,243 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 21:01:34,244 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 21:01:34,244 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 21:01:34,245 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 21:01:34,247 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 21:01:34,249 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 21:01:34,250 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 21:01:34,251 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 21:01:34,322 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 21:01:38,980 - aiogram.dispatcher - WARNING - _signal_stop_polling:491 - Received SIGTERM signal
2025-08-16 21:01:39,232 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 21:01:39,232 - root - INFO - shutdown:125 - Cerrando tareas en segundo plano...
2025-08-16 21:01:39,232 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-16 21:01:39,232 - root - INFO - safe_task:114 - Tarea channel_requests cancelada
2025-08-16 21:01:39,232 - root - INFO - vip_subscription_scheduler:137 - VIP subscription scheduler cancelled
2025-08-16 21:01:39,232 - root - INFO - safe_task:114 - Tarea vip_subscriptions cancelada
2025-08-16 21:01:39,232 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-16 21:01:39,232 - root - INFO - safe_task:114 - Tarea vip_memberships cancelada
2025-08-16 21:01:39,232 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-16 21:01:39,232 - root - INFO - safe_task:114 - Tarea auction_monitor cancelada
2025-08-16 21:01:39,232 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-16 21:01:39,232 - root - INFO - safe_task:114 - Tarea channel_cleanup cancelada
2025-08-16 21:01:39,232 - root - INFO - shutdown:134 - Todas las tareas cerradas
2025-08-16 21:25:11,699 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 21:25:11,699 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 21:25:11,715 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 21:25:11,730 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 21:25:11,731 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 21:25:11,731 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 21:25:11,731 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 21:25:11,772 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 21:25:11,772 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 21:25:11,773 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 21:25:11,773 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 21:25:11,774 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 21:25:11,776 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 21:25:11,777 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 21:25:11,778 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 21:25:11,779 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 21:25:11,845 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 21:25:13,608 - aiogram.dispatcher - WARNING - _signal_stop_polling:491 - Received SIGTERM signal
2025-08-16 21:25:13,860 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-16 21:25:13,860 - root - INFO - shutdown:125 - Cerrando tareas en segundo plano...
2025-08-16 21:25:13,861 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-16 21:25:13,861 - root - INFO - safe_task:114 - Tarea channel_requests cancelada
2025-08-16 21:25:13,861 - root - INFO - vip_subscription_scheduler:137 - VIP subscription scheduler cancelled
2025-08-16 21:25:13,861 - root - INFO - safe_task:114 - Tarea vip_subscriptions cancelada
2025-08-16 21:25:13,861 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-16 21:25:13,861 - root - INFO - safe_task:114 - Tarea vip_memberships cancelada
2025-08-16 21:25:13,861 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-16 21:25:13,861 - root - INFO - safe_task:114 - Tarea auction_monitor cancelada
2025-08-16 21:25:13,861 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-16 21:25:13,861 - root - INFO - safe_task:114 - Tarea channel_cleanup cancelada
2025-08-16 21:25:13,861 - root - INFO - shutdown:134 - Todas las tareas cerradas
2025-08-16 22:55:42,527 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-16 22:55:42,527 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-16 22:55:42,575 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-16 22:55:42,592 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-16 22:55:42,593 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-16 22:55:42,593 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-16 22:55:42,593 - __main__ - INFO - main:153 - Configurando bot...
2025-08-16 22:55:42,634 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router setup registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router admin registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router start registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router missions registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router info registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-16 22:55:42,634 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router lore registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-16 22:55:42,635 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-16 22:55:42,635 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-16 22:55:42,636 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-16 22:55:42,639 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-16 22:55:42,640 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-16 22:55:42,641 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-16 22:55:42,642 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-16 22:55:42,703 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-16 22:55:43,976 - handlers.vip.gamification - WARNING - handle_unrecognized_text:456 - Unrecognized message from user 1280444712: Perfecto procede con la eliminación de esta capa de fake multi-tenant,
2025-08-16 22:56:31,862 - utils.menu_factory - WARNING - _create_specific_menu:255 - Unknown specific menu state: admin_free_channel. Falling back to main menu for role: admin
2025-08-16 22:56:31,863 - utils.menu_manager - ERROR - go_back:242 - Error going back for user 1280444712: cannot unpack non-iterable coroutine object
2025-08-16 22:56:45,002 - utils.menu_manager - ERROR - go_back:242 - Error going back for user 1280444712: cannot unpack non-iterable coroutine object
2025-08-16 22:57:02,096 - __main__ - ERROR - global_error_handler:88 - Error en 226871100: NameError: name 'session' is not defined
Traceback (most recent call last):
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/bot.py", line 40, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/middlewares/user_middleware.py", line 59, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 174, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/venv/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/home/carlostoek/repos/bolt_ok/mybot/handlers/admin/game_admin.py", line 758, in admin_reward_add
    if not await is_admin(callback.from_user.id, session):
                                                 ^^^^^^^
NameError: name 'session' is not defined. Did you mean: 'Mission'?
2025-08-17 01:38:23,239 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-17 01:38:23,239 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-17 01:38:23,255 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-17 01:38:23,272 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-17 01:38:23,273 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-17 01:38:23,273 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-17 01:38:23,274 - __main__ - INFO - main:153 - Configurando bot...
2025-08-17 01:38:23,316 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router setup registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router admin registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router start registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-17 01:38:23,316 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router missions registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router info registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router lore registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-17 01:38:23,317 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-17 01:38:23,317 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-17 01:38:23,318 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-17 01:38:23,320 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-17 01:38:23,321 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-17 01:38:23,322 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-17 01:38:23,323 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-17 01:38:23,382 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-17 01:38:24,102 - handlers.start - INFO - cmd_start:29 - Start command received from user 1280444712
2025-08-17 01:38:24,103 - handlers.start - INFO - cmd_start:71 - Admin user 1280444712 accessing start command
2025-08-17 01:38:24,131 - services.tenant_service - INFO - initialize_tenant:48 - Initialized tenant for admin 1280444712
2025-08-17 01:39:27,347 - services.user_service - INFO - create_user:55 - Created new user: 6181290784
2025-08-17 01:39:27,348 - middlewares.user_middleware - INFO - __call__:49 - Created new user via middleware: 6181290784
2025-08-17 01:39:27,362 - handlers.start - INFO - cmd_start:29 - Start command received from user 6181290784
2025-08-17 01:39:27,363 - handlers.start - INFO - cmd_start:115 - Regular user 6181290784 accessing start command
2025-08-17 03:08:59,137 - __main__ - INFO - main:144 - Inicializando base de datos...
2025-08-17 03:08:59,137 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-17 03:08:59,153 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-17 03:08:59,172 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-17 03:08:59,173 - __main__ - INFO - main:147 - Aplicando parches de seguridad...
2025-08-17 03:08:59,174 - __main__ - INFO - main:152 - VIP channel ID: 0
2025-08-17 03:08:59,174 - __main__ - INFO - main:153 - Configurando bot...
2025-08-17 03:08:59,214 - __main__ - INFO - main:182 - Registrando handlers...
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router setup registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router admin registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router auction_admin registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router start_token registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router start registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router main_menu registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router backpack registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router missions registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router info registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router free_channel_admin registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router publication_test registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router vip_menu registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router auction_user registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router reaction_callback registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router daily_gift registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router minigames registrado
2025-08-17 03:08:59,214 - __main__ - INFO - main:212 - Router gamification registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router free_user registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router lore registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router combinar_pistas registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router channel_access registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router narrative registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router admin_narrative registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:212 - Router free_channel_config registrado
2025-08-17 03:08:59,215 - __main__ - INFO - main:217 - Iniciando tareas en segundo plano...
2025-08-17 03:08:59,215 - __main__ - INFO - main:240 - Bot iniciado correctamente. Comenzando polling...
2025-08-17 03:08:59,216 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-17 03:08:59,218 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-17 03:08:59,219 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-17 03:08:59,219 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-17 03:08:59,221 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-17 03:08:59,283 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-17 03:11:14,274 - services.message_service - INFO - send_interactive_post:84 - DEBUG: Markup to edit: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_5_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_5_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 0', url=None, callback_data='ip_-1001468184215_5_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_5_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 0', url=None, callback_data='ip_-1001468184215_5_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)]]
2025-08-17 03:11:14,571 - services.message_registry - INFO - store_message:18 - Stored message (-1001468184215, 5)
2025-08-17 03:11:25,406 - services.message_registry - INFO - validate_message:29 - Validation attempt for chat_id=-1001468184215, message_id=5: True
2025-08-17 03:11:25,407 - handlers.reaction_callback - INFO - handle_reaction_callback:41 - Edit attempt chat_id=-1001468184215 message_id=5 valid=True
2025-08-17 03:11:25,779 - services.point_service - INFO - add_points:145 - User 1280444712 gained 2 points (base 1, x2). Total: 2.0
2025-08-17 03:11:26,066 - services.mission_service - INFO - complete_mission:172 - User 1280444712 successfully completed mission reaction_reaccionar_5 (Type: reaction, Message: 5).
2025-08-17 03:11:26,265 - services.point_service - INFO - add_points:145 - User 1280444712 gained 1.0 points (base 0.5, x2). Total: 3.0
2025-08-17 03:11:26,451 - services.point_service - INFO - add_points:145 - User 1280444712 gained 2 points (base 1, x2). Total: 5.0
2025-08-17 03:11:27,117 - services.message_service - INFO - update_reaction_markup:188 - DEBUG: Markup being sent for update: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_5_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_5_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 1', url=None, callback_data='ip_-1001468184215_5_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_5_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 0', url=None, callback_data='ip_-1001468184215_5_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)]]
2025-08-17 03:12:21,796 - handlers.admin.subscription_plans - INFO - tariff_name:273 - Admin 1280444712 created tariff: Una (7d, $5)
2025-08-17 03:12:28,757 - services.token_service - INFO - create_vip_token:93 - VIP token created: e2MwPznvKNTUyKf6FOyIyQ for tariff 1
2025-08-17 03:12:29,192 - handlers.admin.vip_menu - INFO - vip_create_token:142 - Admin 1280444712 generated VIP token for tariff Una
2025-08-17 03:12:41,185 - handlers.user.start_token - INFO - start_with_token:31 - User 6181290784 attempting to activate token: e2MwPznvKNTUyKf6FOyIyQ
2025-08-17 03:12:41,187 - services.token_service - INFO - activate_token:50 - Token e2MwPznvKNTUyKf6FOyIyQ activated by user 6181290784 for 7 days
2025-08-17 03:12:41,214 - handlers.user.start_token - INFO - start_with_token:39 - Token e2MwPznvKNTUyKf6FOyIyQ activated successfully for user 6181290784, duration: 7 days
2025-08-17 03:12:41,238 - services.subscription_service - INFO - create_subscription:32 - Created VIP subscription for user 6181290784, expires: 2025-08-24 03:12:41.215407
2025-08-17 03:12:41,238 - handlers.user.start_token - INFO - start_with_token:71 - Created new subscription for user 6181290784
2025-08-17 03:12:42,037 - handlers.user.start_token - INFO - start_with_token:93 - Generated VIP invite link for user 6181290784
2025-08-17 03:12:42,624 - handlers.user.start_token - INFO - start_with_token:114 - VIP activation completed for user 6181290784
2025-08-17 03:13:05,598 - services.message_registry - INFO - validate_message:29 - Validation attempt for chat_id=-1001468184215, message_id=5: True
2025-08-17 03:13:05,598 - handlers.reaction_callback - INFO - handle_reaction_callback:41 - Edit attempt chat_id=-1001468184215 message_id=5 valid=True
2025-08-17 03:13:05,673 - services.point_service - INFO - add_points:145 - User 6181290784 gained 2 points (base 1, x2). Total: 2.0
2025-08-17 03:13:05,968 - services.mission_service - INFO - complete_mission:172 - User 6181290784 successfully completed mission reaction_reaccionar_5 (Type: reaction, Message: 5).
2025-08-17 03:13:05,996 - services.point_service - INFO - add_points:145 - User 6181290784 gained 1.0 points (base 0.5, x2). Total: 3.0
2025-08-17 03:13:06,022 - services.point_service - INFO - add_points:145 - User 6181290784 gained 2 points (base 1, x2). Total: 5.0
2025-08-17 03:13:06,614 - services.message_service - INFO - update_reaction_markup:188 - DEBUG: Markup being sent for update: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_5_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_5_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 1', url=None, callback_data='ip_-1001468184215_5_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_5_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 1', url=None, callback_data='ip_-1001468184215_5_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, copy_text=None, callback_game=None, pay=None)]]
2025-08-17 03:15:37,696 - aiogram.dispatcher - WARNING - _signal_stop_polling:491 - Received SIGINT signal
2025-08-17 03:15:37,949 - __main__ - INFO - main:247 - Cerrando bot...
2025-08-17 03:15:37,949 - root - INFO - shutdown:125 - Cerrando tareas en segundo plano...
2025-08-17 03:15:37,949 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-17 03:15:37,949 - root - INFO - safe_task:114 - Tarea channel_requests cancelada
2025-08-17 03:15:37,949 - root - INFO - vip_subscription_scheduler:137 - VIP subscription scheduler cancelled
2025-08-17 03:15:37,949 - root - INFO - safe_task:114 - Tarea vip_subscriptions cancelada
2025-08-17 03:15:37,949 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-17 03:15:37,949 - root - INFO - safe_task:114 - Tarea vip_memberships cancelada
2025-08-17 03:15:37,950 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-17 03:15:37,950 - root - INFO - safe_task:114 - Tarea auction_monitor cancelada
2025-08-17 03:15:37,950 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-17 03:15:37,950 - root - INFO - safe_task:114 - Tarea channel_cleanup cancelada
2025-08-17 03:15:37,950 - root - INFO - shutdown:134 - Todas las tareas cerradas
2025-08-20 10:54:07,694 - __main__ - INFO - main:145 - Inicializando base de datos...
2025-08-20 10:54:07,694 - database.setup - INFO - init_db:64 - Inicializando motor de base de datos SQLite...
2025-08-20 10:54:07,756 - database.setup - INFO - init_db:76 - Creando tablas en orden definido...
2025-08-20 10:54:07,834 - database.setup - INFO - init_db:79 - Tablas creadas exitosamente.
2025-08-20 10:54:07,838 - __main__ - INFO - main:148 - Aplicando parches de seguridad...
2025-08-20 10:54:07,839 - __main__ - INFO - main:153 - VIP channel ID: 0
2025-08-20 10:54:07,839 - __main__ - INFO - main:154 - Configurando bot...
2025-08-20 10:54:07,873 - __main__ - INFO - main:183 - Registrando handlers...
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router setup registrado
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router admin registrado
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router auction_admin registrado
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router start_token registrado
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router start registrado
2025-08-20 10:54:07,873 - __main__ - INFO - main:214 - Router main_menu registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router backpack registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router missions registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router info registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router free_channel_admin registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router publication_test registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router vip_menu registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router auction_user registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router reaction_callback registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router native_reaction registrado
2025-08-20 10:54:07,874 - __main__ - INFO - main:214 - Router daily_gift registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router minigames registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router gamification registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router free_user registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router lore registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router combinar_pistas registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router channel_access registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router narrative registrado
2025-08-20 10:54:07,875 - __main__ - INFO - main:214 - Router admin_narrative registrado
2025-08-20 10:54:07,876 - __main__ - INFO - main:214 - Router free_channel_config registrado
2025-08-20 10:54:07,876 - __main__ - INFO - main:219 - Iniciando tareas en segundo plano...
2025-08-20 10:54:07,876 - __main__ - INFO - main:242 - Bot iniciado correctamente. Comenzando polling...
2025-08-20 10:54:07,878 - root - INFO - channel_request_scheduler:28 - Channel request scheduler started
2025-08-20 10:54:07,881 - root - INFO - vip_subscription_scheduler:125 - VIP subscription scheduler started
2025-08-20 10:54:07,883 - root - INFO - vip_membership_scheduler:145 - VIP membership scheduler started
2025-08-20 10:54:07,885 - root - INFO - auction_monitor_scheduler:177 - Auction monitor scheduler started
2025-08-20 10:54:07,887 - root - INFO - free_channel_cleanup_scheduler:204 - Free channel cleanup scheduler started
2025-08-20 10:54:08,028 - services.free_channel_service - INFO - cleanup_old_requests:729 - Cleaned up 0 old channel requests
2025-08-20 10:54:08,875 - services.subscription_service - INFO - create_subscription:32 - Created VIP subscription for user 1280444712, expires: None
2025-08-20 10:54:09,493 - root - INFO - run_vip_membership_check:120 - Synced 1 users to VIP role via channel
2025-08-20 10:54:47,096 - services.message_service - INFO - send_interactive_post:84 - DEBUG: Markup to edit: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_40_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_40_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 0', url=None, callback_data='ip_-1001468184215_40_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_40_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 0', url=None, callback_data='ip_-1001468184215_40_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)]]
2025-08-20 10:54:47,408 - services.message_registry - INFO - store_message:18 - Stored message (-1001468184215, 40)
2025-08-20 10:54:51,168 - services.message_registry - INFO - validate_message:29 - Validation attempt for chat_id=-1001468184215, message_id=40: True
2025-08-20 10:54:51,169 - handlers.reaction_callback - INFO - handle_reaction_callback:41 - Edit attempt chat_id=-1001468184215 message_id=40 valid=True
2025-08-20 10:54:51,276 - services.point_service - INFO - add_points:254 - User 1280444712 gained 2 points (base 1, x2). Total: 7.0
2025-08-20 10:54:51,298 - services.mission_service - INFO - complete_mission:178 - Sent unified mission completion notification to user 1280444712
2025-08-20 10:54:51,298 - services.mission_service - INFO - complete_mission:191 - User 1280444712 successfully completed mission reaction_reaccionar_40 (Type: reaction, Message: 40).
2025-08-20 10:54:51,363 - services.point_service - INFO - add_points:254 - User 1280444712 gained 1.0 points (base 0.5, x2). Total: 8.0
2025-08-20 10:54:51,452 - services.point_service - INFO - add_points:254 - User 1280444712 gained 1 points (base 1, x1). Total: 9.0
2025-08-20 10:54:51,455 - handlers.reaction_callback - INFO - handle_reaction_callback:87 - Reacción registrada para user_id=1280444712 sin notificaciones duplicadas
2025-08-20 10:54:51,469 - services.message_service - INFO - update_reaction_markup:188 - DEBUG: Markup being sent for update: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_40_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_40_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 0', url=None, callback_data='ip_-1001468184215_40_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_40_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 1', url=None, callback_data='ip_-1001468184215_40_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)]]
2025-08-20 10:54:52,599 - services.notification_service - INFO - _send_notifications_now:161 - Sent unified notification to user 1280444712: 1 items
2025-08-20 10:55:09,115 - services.message_registry - INFO - validate_message:29 - Validation attempt for chat_id=-1001468184215, message_id=40: True
2025-08-20 10:55:09,116 - handlers.reaction_callback - INFO - handle_reaction_callback:41 - Edit attempt chat_id=-1001468184215 message_id=40 valid=True
2025-08-20 10:55:09,266 - services.point_service - INFO - add_points:254 - User 6181290784 gained 2 points (base 1, x2). Total: 7.0
2025-08-20 10:55:09,297 - services.mission_service - INFO - complete_mission:178 - Sent unified mission completion notification to user 6181290784
2025-08-20 10:55:09,297 - services.mission_service - INFO - complete_mission:191 - User 6181290784 successfully completed mission reaction_reaccionar_40 (Type: reaction, Message: 40).
2025-08-20 10:55:09,363 - services.point_service - INFO - add_points:254 - User 6181290784 gained 1.0 points (base 0.5, x2). Total: 8.0
2025-08-20 10:55:09,463 - services.point_service - INFO - add_points:254 - User 6181290784 gained 1 points (base 1, x1). Total: 9.0
2025-08-20 10:55:09,466 - handlers.reaction_callback - INFO - handle_reaction_callback:87 - Reacción registrada para user_id=6181290784 sin notificaciones duplicadas
2025-08-20 10:55:09,497 - services.message_service - INFO - update_reaction_markup:188 - DEBUG: Markup being sent for update: inline_keyboard=[[InlineKeyboardButton(text='👍 0', url=None, callback_data='ip_-1001468184215_40_👍', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='❤️ 0', url=None, callback_data='ip_-1001468184215_40_❤️', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='😂 0', url=None, callback_data='ip_-1001468184215_40_😂', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None), InlineKeyboardButton(text='🔥 0', url=None, callback_data='ip_-1001468184215_40_🔥', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)], [InlineKeyboardButton(text='💯 2', url=None, callback_data='ip_-1001468184215_40_💯', web_app=None, login_url=None, switch_inline_query=None, switch_inline_query_current_chat=None, switch_inline_query_chosen_chat=None, callback_game=None, pay=None)]]
2025-08-20 10:55:10,984 - services.notification_service - INFO - _send_notifications_now:161 - Sent unified notification to user 6181290784: 1 items
2025-08-20 10:55:19,299 - __main__ - ERROR - global_error_handler:89 - Error en 226871442: TypeError: 'AsyncSession' object is not callable
Traceback (most recent call last):
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/bot.py", line 40, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/middlewares/user_middleware.py", line 59, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/middlewares/points_middleware.py", line 90, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/handlers/main_menu.py", line 10, in handle_backpack_button
    await mostrar_mochila_narrativa(message)
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/backpack.py", line 58, in mostrar_mochila_narrativa
    async with session_factory() as session:
               ^^^^^^^^^^^^^^^^^
TypeError: 'AsyncSession' object is not callable
2025-08-20 10:55:24,883 - __main__ - ERROR - global_error_handler:89 - Error en 226871444: AttributeError: type object 'cb' has no attribute 'answer'
Traceback (most recent call last):
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/middlewares/user_context.py", line 49, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/fsm/middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/bot.py", line 40, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/middlewares/user_middleware.py", line 59, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 170, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 142, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 137, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/router.py", line 162, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/middlewares/points_middleware.py", line 90, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/usr/lib/python3.12/site-packages/aiogram/dispatcher/event/handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/handlers/main_menu.py", line 20, in handle_missions_button
    await show_available_missions(fake_callback, session)
  File "/data/data/com.termux/files/home/repos/bolt_ok/mybot/handlers/missions_handler.py", line 13, in show_available_missions
    await callback.answer("Cargando misiones...", show_alert=False)
          ^^^^^^^^^^^^^^^
AttributeError: type object 'cb' has no attribute 'answer'
2025-08-20 10:56:28,736 - aiogram.dispatcher - WARNING - _signal_stop_polling:455 - Received SIGINT signal
2025-08-20 10:56:28,994 - __main__ - INFO - main:249 - Cerrando bot...
2025-08-20 10:56:28,996 - root - INFO - shutdown:126 - Cerrando tareas en segundo plano...
2025-08-20 10:56:28,996 - root - INFO - channel_request_scheduler:40 - Channel request scheduler cancelled
2025-08-20 10:56:28,997 - root - INFO - safe_task:115 - Tarea channel_requests cancelada
2025-08-20 10:56:28,997 - root - INFO - vip_subscription_scheduler:137 - VIP subscription scheduler cancelled
2025-08-20 10:56:28,998 - root - INFO - safe_task:115 - Tarea vip_subscriptions cancelada
2025-08-20 10:56:28,998 - root - INFO - vip_membership_scheduler:157 - VIP membership scheduler cancelled
2025-08-20 10:56:28,998 - root - INFO - safe_task:115 - Tarea vip_memberships cancelada
2025-08-20 10:56:28,999 - root - INFO - auction_monitor_scheduler:184 - Auction monitor scheduler cancelled
2025-08-20 10:56:28,999 - root - INFO - safe_task:115 - Tarea auction_monitor cancelada
2025-08-20 10:56:29,000 - root - INFO - free_channel_cleanup_scheduler:211 - Free channel cleanup scheduler cancelled
2025-08-20 10:56:29,000 - root - INFO - safe_task:115 - Tarea channel_cleanup cancelada
2025-08-20 10:56:29,001 - root - INFO - shutdown:135 - Todas las tareas cerradas
